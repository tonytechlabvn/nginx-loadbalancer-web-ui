# STAGE 1: Build ứng dụng TypeScript/React
# Dùng image Node.js (bản 18, alpine cho nhẹ) làm "môi trường build"
FROM node:18-alpine AS builder

# Đặt thư mục làm việc bên trong container
WORKDIR /app

# Chép file package.json và package-lock.json trước
COPY package*.json ./

# Cài đặt các thư viện (dependencies)
RUN npm install

# Chép toàn bộ source code còn lại vào
COPY . .

# Chạy lệnh build (lệnh này sẽ tạo ra thư mục /app/dist)
RUN npm run build

# STAGE 2: Serve ứng dụng đã build bằng Nginx
# Dùng image Nginx (bản alpine cho nhẹ) làm "máy chủ web"
FROM nginx:alpine

# Chép C_H_Ỉ thư mục build (kết quả của Stage 1)
# vào thư mục web root mặc định của Nginx
COPY --from=builder /app/dist /usr/share/nginx/html

# Chép file cấu hình Nginx (đã có sẵn trong repo của bạn)
# File này rất quan trọng để xử lý routing của React (tránh lỗi 404 khi F5)
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Mở cổng 80
EXPOSE 80

# Khởi chạy Nginx
CMD ["nginx", "-g", "daemon off;"]
